<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>„É°„Éã„É•„Éº| Á§æÂì°ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  
  
  <title>„Çπ„Éº„Éë„ÉºÊú¨Ê†º„Çπ„É≠„ÉÉ„Éà</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      user-select: none;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 30px;
    }
    .machine {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }
    .reel-container {
      width: 150px;
      height: 150px;
      border: 5px solid white;
      border-radius: 15px;
      background: black;
      overflow: hidden;
      position: relative;
      box-sizing: border-box;
      transition: box-shadow 0.4s ease;
    }
    .reel-container.win {
      box-shadow: 0 0 20px 8px #0f0;
      animation: glow 1s infinite alternate;
    }
    @keyframes glow {
      from {
        box-shadow: 0 0 20px 8px #0f0;
      }
      to {
        box-shadow: 0 0 40px 12px #0f0;
      }
    }
    .reel {
      position: absolute;
      width: 100%;
      top: 0;
      transition: top 0.1s linear;
    }
    .reel img {
      width: 100%;
      height: 150px;
      object-fit: contain;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
    }
    button {
      font-size: 1.1rem;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #0f0;
      color: black;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    button:disabled {
      background: #555;
      color: #999;
      cursor: not-allowed;
    }
    .status {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    .bet-controls {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <h1>„Çπ„Éº„Éë„ÉºÊú¨Ê†º„Çπ„É≠„ÉÉ„Éà„Éû„Ç∑„É≥</h1>

  <div class="status">
    „É°„ÉÄ„É´ÊÆãÈ´ò: <span id="coins">1000</span> Êûö
  </div>
  <div class="bet-controls">
    BET: <button id="betMinus">‚àí</button>
    <span id="betAmount">10</span>
    <button id="betPlus">Ôºã</button>
  </div>

  <div class="machine">
    <div class="reel-container" id="container1"><div class="reel" id="reel1"></div></div>
    <div class="reel-container" id="container2"><div class="reel" id="reel2"></div></div>
    <div class="reel-container" id="container3"><div class="reel" id="reel3"></div></div>
  </div>

  <div class="controls">
    <button id="startBtn">„Çπ„Çø„Éº„Éà</button>
    <button id="stop1" disabled>STOP 1</button>
    <button id="stop2" disabled>STOP 2</button>
    <button id="stop3" disabled>STOP 3</button>
  </div>

  <audio id="spinSound" src="https://actions.google.com/sounds/v1/transportation/car_door_open_close.ogg" preload="auto"></audio>
  <audio id="stopSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
  <audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/concussive_hit_guitar_boing.ogg" preload="auto"></audio>

  <script>
	const images = ['‰ø∫.jpg', 'ÂéüÁî∞.jpg', '„Ç≥„Éì„Éº1.webp', '„Ç≥„Éì„Éº2.webp'];
    const imagePath = 'img/';
    const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
    const containers = [document.getElementById('container1'), document.getElementById('container2'), document.getElementById('container3')];
    const spinSound = document.getElementById('spinSound');
    const stopSound = document.getElementById('stopSound');
    const winSound = document.getElementById('winSound');

    const startBtn = document.getElementById('startBtn');
    const stopButtons = [document.getElementById('stop1'), document.getElementById('stop2'), document.getElementById('stop3')];
    const coinsElem = document.getElementById('coins');
    const betAmountElem = document.getElementById('betAmount');
    const betMinus = document.getElementById('betMinus');
    const betPlus = document.getElementById('betPlus');

    let intervals = [null, null, null];
    let stopped = [false, false, false];
    let coins = 1000;
    let bet = 10;
    const minBet = 10;
    const maxBet = 100;

    // ÁîªÂÉè„Çí„É™„Éº„É´„Å´ËøΩÂä†
    function fillReel(reel) {
      reel.innerHTML = '';
      for (let i = 0; i < 20; i++) {
        const img = document.createElement('img');
        img.src = imagePath + images[Math.floor(Math.random() * images.length)];
        reel.appendChild(img);
      }
    }

    // BETË™øÊï¥
    betMinus.onclick = () => {
      if (bet > minBet) {
        bet -= 10;
        betAmountElem.textContent = bet;
      }
    };
    betPlus.onclick = () => {
      if (bet < maxBet) {
        bet += 10;
        betAmountElem.textContent = bet;
      }
    };

    // „Çπ„Çø„Éº„ÉàÂá¶ÁêÜ
    startBtn.onclick = () => {
      if (coins < bet) {
        alert('„É°„ÉÄ„É´„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ');
        return;
      }
      coins -= bet;
      coinsElem.textContent = coins;

      stopped = [false, false, false];

      reels.forEach((reel, i) => {
        fillReel(reel);
        reel.style.top = '0px';
      });

      startSpin();
      // „Éú„Çø„É≥Âà∂Âæ°
      startBtn.disabled = true;
      stopButtons.forEach((btn, i) => btn.disabled = i !== 0);
      containers.forEach(c => c.classList.remove('win'));
    };

    // „Çπ„Éî„É≥ÈñãÂßãÔºàrequestAnimationFrame„ÅßÈÄ£Á∂öÂõûËª¢Ôºâ
    let spinPositions = [0, 0, 0];
    let spinSpeeds = [20, 25, 30];
    let spinning = false;

    function spinStep() {
      if (!spinning) return;
      reels.forEach((reel, i) => {
        spinPositions[i] -= spinSpeeds[i];
        const totalHeight = reel.scrollHeight;
        if (spinPositions[i] <= -totalHeight + 150) {
          spinPositions[i] = 0;
        }
        reel.style.top = spinPositions[i] + 'px';
      });
      requestAnimationFrame(spinStep);
    }

    function startSpin() {
      spinning = true;
      spinPositions = [0, 0, 0];
      spinSpeeds = [20, 25, 30];
      spinSound.loop = true;
      spinSound.play();
      spinStep();
    }

    // „Çπ„Éà„ÉÉ„ÉóÂá¶ÁêÜ
    function stopReel(index) {
      if (!spinning) return;
      stopSound.play();
      clearInterval(intervals[index]); // Âøµ„ÅÆ„Åü„ÇÅ

      // „É™„Éº„É´„ÅÆÈÄüÂ∫¶„Çí0„Åæ„ÅßÊ∏õÈÄüÔºàÁ∞°ÊòìÁâàÔºâ
      
      const decelerate = () => {
        if (spinSpeeds[index] > 0) {
          spinSpeeds[index] -= 1;
          if (spinSpeeds[index] < 0) spinSpeeds[index] = 0;
          setTimeout(decelerate, 50);
        } else {
          spinSpeeds[index] = 0;
          stopped[index] = true;
          stopButtons[index].disabled = true;
          if (index < stopButtons.length -1) {
            stopButtons[index + 1].disabled = false;
          } else {
            spinning = false;
            spinSound.pause();
            spinSound.currentTime = 0;
            setTimeout(checkResult, 500);
          }
        }
      };
      decelerate();
    }

    stopButtons.forEach((btn, i) => {
      btn.onclick = () => stopReel(i);
    });

    // ÁµêÊûúÂà§ÂÆöÔºÜÊºîÂá∫
    function checkResult() {
      const getTopSymbol = (reel) => {
        const top = Math.abs(parseInt(reel.style.top)) || 0;
        const index = Math.floor(top / 150);
        const img = reel.getElementsByTagName('img')[index];
        return img ? img.src.split('/').pop() : '';
      };

      const results = reels.map(getTopSymbol);

      console.log('ÁµêÊûú:', results);

      const containerWins = [];

      if (results.every(r => r === results[0])) {
        alert(`üéâ Â§ßÂΩì„Åü„ÇäÔºÅ„Äå${results[0]}„Äç„Åå3„Å§ÊèÉ„Å£„ÅüÔºÅ`);
        coins += bet * 10;
        winSound.play();
        containerWins.push(0, 1, 2);
      } else if (new Set(results).size === 2) {
        alert('üòä 2„Å§ÊèÉ„Å£„Åü„ÇàÔºÅ');
        coins += bet * 2;
        winSound.play();
        // 2„Å§ÊèÉ„ÅÑ„ÅÆÂÖâ„ÇäÊñπ„ÇíÈÅ©ÂΩì„Å´ÊåáÂÆö
        const first = results.findIndex((v, i, arr) => arr.filter(x => x === v).length === 2);
        const second = results.findIndex((v, i, arr) => arr.filter(x => x === v).length === 2 && i !== first);
        containerWins.push(first, second);
      } else {
        alert('üò¢ „Éè„Ç∫„É¨...');
      }

      coinsElem.textContent = coins;

      // ÂÖâ„ÇãÊºîÂá∫
      containers.forEach((c, i) => {
        if (containerWins.includes(i)) {
          c.classList.add('win');
        } else {
          c.classList.remove('win');
        }
      });

      // „Çπ„Çø„Éº„Éà„Éú„Çø„É≥Âæ©Ê¥ª
      startBtn.disabled = false;
      stopButtons.forEach(btn => btn.disabled = true);
    }
  </script>


	
</body>


</html>