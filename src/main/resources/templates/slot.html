<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>ãƒ¡ãƒ‹ãƒ¥ãƒ¼| ç¤¾å“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  
  
  <title>ã‚¹ãƒ¼ãƒ‘ãƒ¼æœ¬æ ¼ã‚¹ãƒ­ãƒƒãƒˆ</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      user-select: none;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 30px;
    }
    .machine {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }
    .reel-container {
      width: 150px;
      height: 150px;
      border: 5px solid white;
      border-radius: 15px;
      background: black;
      overflow: hidden;
      position: relative;
      box-sizing: border-box;
      transition: box-shadow 0.4s ease;
    }
    .reel-container.win {
      box-shadow: 0 0 20px 8px #0f0;
      animation: glow 1s infinite alternate;
    }
    @keyframes glow {
      from {
        box-shadow: 0 0 20px 8px #0f0;
      }
      to {
        box-shadow: 0 0 40px 12px #0f0;
      }
    }
    .reel {
      position: absolute;
      width: 100%;
      top: 0;
      transition: top 0.1s linear;
    }
    .reel img {
      width: 100%;
      height: 150px;
      object-fit: contain;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
    }
    button {
      font-size: 1.1rem;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #0f0;
      color: black;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    button:disabled {
      background: #555;
      color: #999;
      cursor: not-allowed;
    }
    .status {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    .bet-controls {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <style>
  body {
    background: #111;
    color: white;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    user-select: none;
  }
  h1 {
    font-size: 2.5rem;
    margin-bottom: 30px;
  }
  .machine {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-bottom: 20px;
  }
  .reel-container {
    width: 150px;
    height: 150px;
    border: 5px solid white;
    border-radius: 15px;
    background: black;
    overflow: hidden;
    position: relative;
    box-sizing: border-box;
    transition: box-shadow 0.4s ease;
  }
  .reel-container.win {
    box-shadow: 0 0 20px 8px #0f0;
    animation: glow 1s infinite alternate;
  }
  @keyframes glow {
    from {
      box-shadow: 0 0 20px 8px #0f0;
    }
    to {
      box-shadow: 0 0 40px 12px #0f0;
    }
  }
  .reel {
    position: absolute;
    width: 100%;
    top: 0;
  }
  .reel img {
    width: 100%;
    height: 150px;
    object-fit: contain;
    display: block;
  }
  .controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 25px;
  }
  button {
    font-size: 1.1rem;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: #0f0;
    color: black;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }
  button:disabled {
    background: #555;
    color: #999;
    cursor: not-allowed;
  }
  .status {
    font-size: 1.3rem;
    margin-bottom: 10px;
  }
  .bet-controls {
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<h1>ã‚¹ãƒ¼ãƒ‘ãƒ¼æœ¬æ ¼ã‚¹ãƒ­ãƒƒãƒˆ åˆä½“ç‰ˆ</h1>

<div class="status">
  ãƒ¡ãƒ€ãƒ«æ®‹é«˜: <span id="coins">1000</span> æš
</div>
<div class="bet-controls">
  BET: <button id="betMinus">âˆ’</button>
  <span id="betAmount">10</span>
  <button id="betPlus">ï¼‹</button>
</div>

<div class="machine">
  <div class="reel-container" id="container1"><div class="reel" id="reel1"></div></div>
  <div class="reel-container" id="container2"><div class="reel" id="reel2"></div></div>
  <div class="reel-container" id="container3"><div class="reel" id="reel3"></div></div>
</div>

<div class="controls">
  <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <button id="stop1" disabled>STOP 1</button>
  <button id="stop2" disabled>STOP 2</button>
  <button id="stop3" disabled>STOP 3</button>
</div>

<audio id="spinSound" src="https://actions.google.com/sounds/v1/transportation/car_door_open_close.ogg" preload="auto"></audio>
<audio id="stopSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/concussive_hit_guitar_boing.ogg" preload="auto"></audio>

<script>
  // ç”»åƒãƒªã‚¹ãƒˆï¼ˆimgãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã‚Œã¦ãã ã•ã„ï¼‰
  const images = ['ä¿º.jpg', 'åŸç”°.jpg', 'ã‚³ãƒ“ãƒ¼1.webp', 'ã‚³ãƒ“ãƒ¼2.webp'];
  const imagePath = 'img/';
  const reels = [
    document.getElementById('reel1'),
    document.getElementById('reel2'),
    document.getElementById('reel3')
  ];
  const containers = [
    document.getElementById('container1'),
    document.getElementById('container2'),
    document.getElementById('container3')
  ];
  const spinSound = document.getElementById('spinSound');
  const stopSound = document.getElementById('stopSound');
  const winSound = document.getElementById('winSound');

  const startBtn = document.getElementById('startBtn');
  const stopButtons = [
    document.getElementById('stop1'),
    document.getElementById('stop2'),
    document.getElementById('stop3')
  ];
  const coinsElem = document.getElementById('coins');
  const betAmountElem = document.getElementById('betAmount');
  const betMinus = document.getElementById('betMinus');
  const betPlus = document.getElementById('betPlus');

  let coins = 1000;
  let bet = 10;
  const minBet = 10;
  const maxBet = 100;

  let spinning = false;
  let spinPositions = [0, 0, 0];
  let spinSpeeds = [30, 35, 40];
  let stopped = [false, false, false];

  const reelHeight = 150;
  const symbolsCount = 20;

  // BETèª¿æ•´
  betMinus.onclick = () => {
    if (bet > minBet) {
      bet -= 10;
      betAmountElem.textContent = bet;
    }
  };
  betPlus.onclick = () => {
    if (bet < maxBet) {
      bet += 10;
      betAmountElem.textContent = bet;
    }
  };

  // ãƒªãƒ¼ãƒ«ã«ãƒ©ãƒ³ãƒ€ãƒ ãªç”»åƒã‚’20å€‹è©°ã‚ã‚‹
  function fillReel(reel) {
    reel.innerHTML = '';
    for (let i = 0; i < symbolsCount; i++) {
      const img = document.createElement('img');
      img.src = imagePath + images[Math.floor(Math.random() * images.length)];
      reel.appendChild(img);
    }
  }

  // ã‚¹ã‚¿ãƒ¼ãƒˆ
  startBtn.onclick = () => {
    if (coins < bet) {
      alert('ãƒ¡ãƒ€ãƒ«ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
      return;
    }
    coins -= bet;
    coinsElem.textContent = coins;

    stopped = [false, false, false];

    reels.forEach((reel) => {
      fillReel(reel);
      reel.style.top = '0px';
    });

    startSpin();

    startBtn.disabled = true;
    stopButtons.forEach((btn, i) => btn.disabled = i !== 0);
    containers.forEach(c => c.classList.remove('win'));
  };

  // å›è»¢å‡¦ç†ï¼ˆrequestAnimationFrameã§ã‚¹ãƒ ãƒ¼ã‚ºã«ï¼‰
  function spinStep() {
    if (!spinning) return;
    for (let i = 0; i < reels.length; i++) {
      if (!stopped[i]) {
        spinPositions[i] -= spinSpeeds[i];
        const totalHeight = reelHeight * symbolsCount;
        if (spinPositions[i] <= -totalHeight) {
          spinPositions[i] += totalHeight;
        }
        reels[i].style.top = spinPositions[i] + 'px';
      }
    }
    requestAnimationFrame(spinStep);
  }

  function startSpin() {
    spinning = true;
    spinPositions = [0, 0, 0];
    spinSpeeds = [30, 35, 40];
    spinSound.loop = true;
    spinSound.play();
    spinStep();
  }

  // ã‚¹ãƒˆãƒƒãƒ—å‡¦ç†ï¼ˆé †ã«é€Ÿåº¦ã‚’æ¸›é€Ÿã—ã¦æ­¢ã‚ã‚‹ï¼‰
  function stopReel(index) {
    if (!spinning) return;
    stopSound.play();

    let speed = spinSpeeds[index];

    function decelerate() {
      if (speed > 0) {
        speed -= 1;
        if (speed < 0) speed = 0;
        spinSpeeds[index] = speed;
        setTimeout(decelerate, 50);
      } else {
        // é€Ÿåº¦0ã«ãªã£ãŸã‚‰ã€ç”»åƒãŒæ ã«ã´ã£ãŸã‚Šæ­¢ã¾ã‚‹ã‚ˆã†ã«ä½ç½®èª¿æ•´
        stopped[index] = true;
        stopButtons[index].disabled = true;

        // ç”»åƒé«˜ã•150pxã§å‰²ã‚Šåˆ‡ã‚‹ã‚ˆã†ã«topèª¿æ•´ï¼ˆä½™ã‚Šã‚’æ¸›ã‚‰ã™ï¼‰
        let top = spinPositions[index];
        const totalHeight = reelHeight * symbolsCount;
        // topã¯è² ã®å€¤ã§-150ã®å€æ•°ã«ä¸¸ã‚ã‚‹ï¼ˆä¸Šã«ã‚¹ãƒ©ã‚¤ãƒ‰ã—ã¦ã‚‹ï¼‰
        let remainder = top % reelHeight;
        if (remainder !== 0) {
          top = top - remainder;
          spinPositions[index] = top;
          reels[index].style.top = top + 'px';
        }

        if (index < stopButtons.length - 1) {
          stopButtons[index + 1].disabled = false;
        } else {
          spinning = false;
          spinSound.pause();
          spinSound.currentTime = 0;
          setTimeout(checkResult, 300);
        }
      }
    }
    decelerate();
  }

  stopButtons.forEach((btn, i) => {
    btn.onclick = () => stopReel(i);
  });

  // çµæœåˆ¤å®š
  function checkResult() {
    // ãƒªãƒ¼ãƒ«ã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ç”»åƒã‚’å–å¾—
    const results = reels.map((reel, i) => {
      // topã¯è² ã®å€¤ãªã®ã§çµ¶å¯¾å€¤ã‚’ã¨ã‚‹
      let top = Math.abs(spinPositions[i]);
      // ç”»åƒé«˜ã•150pxã§å‰²ã£ãŸå•†ãŒç”»åƒã®index
      let idx = Math.floor(top / reelHeight) % symbolsCount;
      // ãã®ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
      const img = reel.getElementsByTagName('img')[idx];
      return img ? img.src.split('/').pop() : '';
    });

    console.log('çµæœ:', results);

    const containerWins = [];

    if (results.every(r => r === results[0])) {
      alert(`ğŸ‰ å¤§å½“ãŸã‚Šï¼ã€Œ${results[0]}ã€ãŒ3ã¤æƒã£ãŸï¼`);
      coins += bet * 10;
      winSound.play();
      containerWins.push(0, 1, 2);
    } else if (new Set(results).size === 2) {
      alert('ğŸ˜Š 2ã¤æƒã£ãŸã‚ˆï¼');
      coins += bet * 2;
      winSound.play();
      // 2ã¤æƒã„ã®å ´æ‰€ç‰¹å®š
      const first = results.findIndex((v, i, arr) => arr.filter(x => x === v).length === 2);
      const second = results.findIndex((v, i, arr) => arr.filter(x => x === v).length === 2 && i !== first);
      containerWins.push(first, second);
    } else {
      alert('ğŸ˜¢ ãƒã‚ºãƒ¬...');
    }

    coinsElem.textContent = coins;

    // å…‰ã‚‹æ¼”å‡º
    containers.forEach((c, i) => {
      if (containerWins.includes(i)) {
        c.classList.add('win');
      } else {
        c.classList.remove('win');
      }
    });

    startBtn.disabled = false;
    stopButtons.forEach(btn => btn.disabled = true);
  }
  
  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼šã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ã‚¹ã‚¿ãƒ¼ãƒˆã¾ãŸã¯æ¬¡ã®STOPã‚’å®Ÿè¡Œ
document.addEventListener('keydown', (e) => {
  if (e.code === 'Space') {
    e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢

    if (!spinning) {
      // ã‚¹ãƒ”ãƒ³ã—ã¦ãªã„ãªã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆå¯èƒ½
      if (!startBtn.disabled) startBtn.click();
    } else {
      // ã‚¹ãƒ”ãƒ³ä¸­ï¼šæœ€åˆã®æœ‰åŠ¹ãªSTOPãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦æŠ¼ã™
      for (let i = 0; i < stopButtons.length; i++) {
        if (!stopButtons[i].disabled) {
          stopButtons[i].click();
          break;
        }
      }
    }
  }
});

</script>


	
</body>


</html>